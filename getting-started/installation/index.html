
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.5">
    
    
      
        <title>Installation - Envoy Swarm Control Plane</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.75751829.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Envoy Swarm Control Plane" class="md-header-nav__button md-logo" aria-label="Envoy Swarm Control Plane">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Envoy Swarm Control Plane
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Installation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/nstapelbroek/envoy-swarm-control-plane/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Envoy Swarm Control Plane" class="md-nav__button md-logo" aria-label="Envoy Swarm Control Plane">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Envoy Swarm Control Plane
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/nstapelbroek/envoy-swarm-control-plane/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      


  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
      
      <label class="md-nav__link" for="nav-2">
        Getting Started
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Installation
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-well-be-configuring" class="md-nav__link">
    What we'll be configuring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-setting-up-your-docker-swarm" class="md-nav__link">
    1. Setting up your docker swarm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-creating-a-network" class="md-nav__link">
    2. Creating a network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-label-your-edge-nodes" class="md-nav__link">
    3. Label your edge nodes
  </a>
  
    <nav class="md-nav" aria-label="3. Label your edge nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-note-on-using-multiple-nodes" class="md-nav__link">
    A note on using multiple nodes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-deploy-the-envoy-stack" class="md-nav__link">
    4. Deploy the envoy stack
  </a>
  
    <nav class="md-nav" aria-label="4. Deploy the envoy stack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encrypting-the-web" class="md-nav__link">
    Encrypting the web
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-add-labels-to-your-services" class="md-nav__link">
    5. Add labels to your services
  </a>
  
    <nav class="md-nav" aria-label="5. Add labels to your services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#there-is-more" class="md-nav__link">
    There is more
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      


  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
      
      <label class="md-nav__link" for="nav-3">
        Development
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../development/background/" class="md-nav__link">
        Context & Background
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../development/scope/" class="md-nav__link">
        Scope
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-well-be-configuring" class="md-nav__link">
    What we'll be configuring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-setting-up-your-docker-swarm" class="md-nav__link">
    1. Setting up your docker swarm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-creating-a-network" class="md-nav__link">
    2. Creating a network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-label-your-edge-nodes" class="md-nav__link">
    3. Label your edge nodes
  </a>
  
    <nav class="md-nav" aria-label="3. Label your edge nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-note-on-using-multiple-nodes" class="md-nav__link">
    A note on using multiple nodes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-deploy-the-envoy-stack" class="md-nav__link">
    4. Deploy the envoy stack
  </a>
  
    <nav class="md-nav" aria-label="4. Deploy the envoy stack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encrypting-the-web" class="md-nav__link">
    Encrypting the web
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-add-labels-to-your-services" class="md-nav__link">
    5. Add labels to your services
  </a>
  
    <nav class="md-nav" aria-label="5. Add labels to your services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#there-is-more" class="md-nav__link">
    There is more
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nstapelbroek/envoy-swarm-control-plane/edit/master/docs/getting-started/installation.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Installation</h1>
                
                <h2 id="installation">Installation</h2>
<p>Below are the steps you should take to set up and run this software. I keep the most up-to-date code examples in the
<a href="https://github.com/nstapelbroek/envoy-swarm-control-plane/tree/master/deployments">deployments</a> folder of this
repository. Note that this folder might contain some files and folders that are not relevant for these instructions.</p>
<h3 id="what-well-be-configuring">What we'll be configuring</h3>
<p>This setup guide works regardless if you have 3, 5 or 10 hosts in your swarm. This is because we'll address the nodes by
their role instead of their name. Please remember which node plays what kind of role when following the guide.</p>
<p>A high-over overview for our setup consists of:</p>
<ol>
<li>Your DNS servers are pointing towards the ede nodes for the domains you want to host (out of scope for this setup guide)</li>
<li>One or many nodes who are labeled as <code>edge</code> nodes. These nodes will:<ol>
<li>Run Envoy Instances</li>
<li>Accept traffic from the internet on port 80 and 443</li>
<li>Use <a href="https://docs.docker.com/network/host/">host mode</a> for exposing ports to prevent unnecessary network hops.</li>
</ol>
</li>
<li>One swarm manager node that runs the control plane software.</li>
</ol>
<p>A diagram of this setup is given below. You'll notice that you can mix &amp; match the roles to get to a setup that you
prefer. For example, you can handle incoming HTTP traffic on swarm worker nodes and keep your managers isolated!</p>
<p>// todo diagram</p>
<h3 id="1-setting-up-your-docker-swarm">1. Setting up your docker swarm</h3>
<p><img alt="Docker Swarm Rocks" src="https://dockerswarm.rocks/img/logo-light-blue-vectors.svg" /></p>
<p>If you are new to docker swarm or do not have a cluster at this moment: try the steps described
at https://dockerswarm.rocks/ to get you started. When your cluster is all setup, connect to a manager node and proceed.</p>
<h3 id="2-creating-a-network">2. Creating a network</h3>
<p>The envoy instances need a network to communicate with your upstream services. We'll use
a <a href="https://docs.docker.com/network/overlay/">overlay network</a>
specifically to communicate between the reverse proxy and any container that you've configured to handle requests from
the internet.</p>
<p>Here's a command that works for most setups. Feel to tweak it if you prefer a certain subnet mask or encryption.</p>
<div class="highlight"><pre><span></span><code>docker network create --driver<span class="o">=</span>overlay --attachable edge-traffic
</code></pre></div>
<p>Keep in mind the overlay network name (<code>edge-traffic</code>) that you've just created as you will be referring to this network
in your stack files.</p>
<h3 id="3-label-your-edge-nodes">3. Label your edge nodes</h3>
<p>We are going to label one or more nodes in your cluster as an edge node. Labeling the node allows the docker swarm
scheduler to filter for specific nodes when deploying the envoy application.</p>
<p>In the example below I have a pair of nodes in a manager &amp; worker setup. I'm going to label the worker node as an edge
node.</p>
<p><img alt="example where I label a node" src="../../assets/node_labeling.png" /></p>
<div class="highlight"><pre><span></span><code>docker node update --label-add <span class="nv">edge</span><span class="o">=</span><span class="nb">true</span>  <span class="nv">$NODE_ID</span>
</code></pre></div>
<p>Of course, you will have to point the DNS entries for your domain towards the public IP address of the node.</p>
<h4 id="a-note-on-using-multiple-nodes">A note on using multiple nodes</h4>
<p>When using multiple edge nodes you would also have to think about how internet traffic is divided between these nodes.
It's a bit more complicated than adding another IP address to the DNS record.</p>
<h3 id="4-deploy-the-envoy-stack">4. Deploy the envoy stack</h3>
<p>Here is the stack file you can use to get started instantly. It refers to the network we've created in step 2 and
deploys the envoy instances on the edge nodes from step 3.</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.7&#39;</span>

<span class="nt">services</span><span class="p">:</span>
  <span class="nt">control-plane</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nstapelbroek/envoy-swarm-control-plane:0.1</span>
    <span class="nt">command</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--ingress-network</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">edge-traffic</span>
    <span class="nt">deploy</span><span class="p">:</span>
      <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">placement</span><span class="p">:</span>
        <span class="nt">constraints</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">node.role == manager</span>
      <span class="nt">restart_policy</span><span class="p">:</span>
        <span class="nt">condition</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
        <span class="nt">window</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
    <span class="nt">networks</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>

  <span class="nt">proxy</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nstapelbroek/envoy-swarm-edge:0.1</span>
    <span class="nt">deploy</span><span class="p">:</span>
      <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">global</span>
      <span class="nt">placement</span><span class="p">:</span>
        <span class="nt">constraints</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">node.labels.edge == true</span>
      <span class="nt">restart_policy</span><span class="p">:</span>
        <span class="nt">condition</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
        <span class="nt">window</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10s</span>
    <span class="nt">networks</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">edge-traffic</span>
    <span class="nt">ports</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
        <span class="nt">published</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
        <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">host</span>
      <span class="p p-Indicator">-</span> <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
        <span class="nt">published</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
        <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">host</span>


<span class="nt">networks</span><span class="p">:</span>
  <span class="nt">default</span><span class="p">:</span> <span class="p p-Indicator">{</span> <span class="p p-Indicator">}</span>
  <span class="nt">edge-traffic</span><span class="p">:</span>
    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>To deploy this, save the config to a file e.g. stack.yml and deploy it like so:</p>
<div class="highlight"><pre><span></span><code>docker stack deploy --compose-file stack.yml envoy
</code></pre></div>
<p>Then, wait a couple of seconds to let docker pull the images, schedule the tasks and deploy the containers. You can
check the status with:</p>
<div class="highlight"><pre><span></span><code>docker stack ps envoy
</code></pre></div>
<p>The output should be something like this:</p>
<div class="highlight"><pre><span></span><code>ID                  NAME                                     IMAGE                                        NODE                DESIRED STATE       CURRENT STATE          ERROR                         PORTS
m6l8ca4jqc4c        envoy_proxy.vioymhujto4sv1bqlw7d20wcm    nstapelbroek/envoy-swarm-edge:0.1            worker01            Running             Running 5 weeks ago                                  *:443-&gt;443/tcp,*:80-&gt;80/tcp   
o9zzxc1bnokt        envoy_control-plane.1                    nstapelbroek/envoy-swarm-control-plane:0.1   manager01           Running             Running 4 weeks ago                                  
</code></pre></div>
<p>When the services are running, the control plane will read your docker swarm state and communicate this towards the
proxies.</p>
<h4 id="encrypting-the-web">Encrypting the web</h4>
<p>I highly recommend setting up TLS and optional LetsEncrypt. These are just a couple of extra command arguments for your
control plane. Read about it here.</p>
<p>// todo write TLS setup docs</p>
<h3 id="5-add-labels-to-your-services">5. Add labels to your services</h3>
<p>The reverse proxy is running and ready to route traffic. We now have to update or create our services with the right
labels, so the control plane knows which service configuration should reside in the Envoy proxies.</p>
<p>A bare minimal configuration includes a port where your container accepts HTTP traffic and a domain / hostname. An
example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.7&#39;</span>

<span class="nt">services</span><span class="p">:</span>
  <span class="nt">frontend</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nstapelbroek/static-webserver:3</span>
    <span class="nt">deploy</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">envoy.endpoint.port=80</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">envoy.route.domain=example.com</span>
    <span class="nt">networks</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">edge-traffic</span>

<span class="nt">networks</span><span class="p">:</span>
  <span class="nt">edge-traffic</span><span class="p">:</span>
    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>After deploying your application stack / services with the labels. The Envoy proxy will be able to route traffic towards
them. It works just like <a href="https://asciinema.org/a/LEu3l3sLfIVVA6GomAh5cn0Mo">in the demo</a>.</p>
<h4 id="there-is-more">There is more</h4>
<p>There are more configuration labels available! you can route paths, multiple domains and even things like connection
timeouts. See a list of more options here.</p>
<p>// todo write label config docs</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../.." class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Welcome
              </div>
            </div>
          </a>
        
        
          <a href="../../development/background/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Context & Background
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>